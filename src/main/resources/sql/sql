CREATE DATABASE library_new_db with owner postgres;



CREATE DATABASE hibernate_demo_db with owner postgres;

DROP DATABASE librarydb;

DROP TABLE book;
DROP TABLE human;


CREATE TABLE human
(
    human_id      int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    fio           varchar(100) NOT NULL UNIQUE,
    year_of_birth int CHECK ( year_of_birth > 0 ) NOT NULL
);

CREATE TABLE book
(
    book_id   int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    human_id  int REFERENCES human (human_id) ON DELETE SET NULL ,
    title     varchar(150) NOT NULL,
    author    varchar(100) NOT NULL,
    book_year int CHECK ( book_year > 0 ) NOT NULL,
    taken_at timestamp
);




INSERT INTO human(fio, year_of_birth)
values ('Пупкин Валерий Наполеонович', 1986),
       ('Геракл Степан Инокентьевич', 1977),
       ('Валет Дмитрий Иосивович', 1999),
       ('Gates Bill Microsoftovich', 1975),
       ('Mask Ilon Teslovich', 2003);

INSERT INTO book(human_id, title, author, book_year)
values (1, 'JAVA. Руководство для начинающих. Современные методы создания, компиляции и выполнения программ на JAVA',
        'Герберт Шилдт', 2023),
       (5, 'JAVA. Руководство для начинающих. Современные методы создания, компиляции и выполнения программ на JAVA',
        'Герберт Шилдт', 2023),
       (1, 'Чистый код. Создание, анализ и рефакторинг', 'Роберт Мартин', 2021),
       (3, 'Чистый код. Создание, анализ и рефакторинг', 'Роберт Мартин', 2021),
       (2, 'Java. Библиотека профессионала. Том 2', 'Кей Хорстманн', 2022),
       (2, 'Java. Библиотека профессионала. Том 1', 'Кей Хорстманн', 2022),
       (3, 'JAVA. Эффективное программирование', 'Джошуа Блох', 2019),
       (3, 'JAVA EE паттерны проектирования для профессионалов', 'Мурат Йенер и Алекс Фидом', 2019),

       (4, 'Das Kapital', ' Karl Marx', 1867)
;

UPDATE book set human_id=2, title='sdds', author='ds', book_year=123 where book_id=2;

-- String SQL = "UPDATE book SET human_id=?,title=?,author=?,book_year=? WHERE book_id=?";
-- jdbcTemplate.update(SQL, book.getHuman_id(), book.getTitle(),book.getAuthor(),book.getBook_year(),id );
TRUNCATE Book;


select fio,b.human_id,title
from human join book b on Human.human_id = B.human_id;

select * from book;
select * from book;


delete from book where human_id=1;

SELECT  human.* FROM Book Join human On book.human_id = human.human_id WHERE Book.book_id = 4
;